---
layout: post
title: "坦克项目记录（三）"
description: ""
date: 2023-2-24
feature_image: images/2023.2.24/14.png
tags: [Unreal]
---

<!--more-->

<!-- ## 安装 Java 8 并设置环境变量（其他版本也可以，如果已经安装可以跳过）

1. 到 https://www.oracle.com/java/technologies/downloads/#java8-windows 下载 Java8 x64 Installer

![](../images/2023.2.24/0.png)

2. 下载好之后直接双击安装，记下安装目录，比如 `C:\Program Files\Java\jdk1.8.0_361`
3. 配置环境变量
   1. 新建 JAVA_HOME 变量名，变量值为上一步记下的安装目录
      
        ![](../images/2023.2.24/1.png)

   2. 配置 PATH 路径，添加一条 `%JAVA_HOME%\bin`
   
        ![](../images/2023.2.24/2.png)
4. 检查是否配置成功 `java -version` 和 `javac` 命令查看输出是否正常
        ![](../images/2023.2.24/3.png)
   
## 安装 Apache 10 并设置环境变量（其他版本也可以，如果已经安装可以跳过 1-4，进行 5、6 步）

1. 到 https://tomcat.apache.org/download-10.cgi 下载 Tomcat10 zip

![](../images/2023.2.24/4.png)

2. 解压后保存到一个固定路径，记下目录地址，比如 `C:\apache-tomcat-10.1.5-windows-x64\apache-tomcat-10.1.5\bin`
3. 配置环境变量
   1. 新建 CATALINA_HOME 变量名，变量值为上一步记下的安装目录

        ![](../images/2023.2.24/5.png)
    
    2. 配置 PATH 路径，添加一条 `%CATALINA_HOME%\bin`

        ![](../images/2023.2.24/6.png)

4. 修改 Tomcat 端口为 9090（或其他没被占用的端口，需要提前告知 UE 一个固定的端口），在 /conf/server.xml 中的第 68 行中修改 port

![](../images/2023.2.24/7.png)

5. 拷贝 gis 数据到 /webapps/ 下

![](../images/2023.2.24/8.png)

6. 双击运行 /bin/startup.bat，访问 http://localhost:9090/data_gis/shp/height_50/tileset.json、http://localhost:9090/data_gis/dem/single_dem/layer.json、http://localhost:9090/data_gis/fig/tilemapresource.xml 查看文件是否能正常访问

![](../images/2023.2.24/9.png)

![](../images/2023.2.24/10.png)

## UE 流送服务器搭建

1. 右键使用 PowerShell 运行 /SignallingWebServer/platform_scripts/cmd/Start_WithTURN_SignallingServer.ps1，需要多等一会启动服务，需要保证 80、8888、8889、443、9999 端口不被其他进程占用，访问 localhost 能看到一个界面

![](../images/2023.2.24/11.png)

![](../images/2023.2.24/12.png)

## UE 客户端运行

1. 右键 /Windows/launch.bat 运行 UE，再次访问 localhost 点击屏幕中央，能够看到流送画面

![](../images/2023.2.24/13.png)

![](../images/2023.2.24/14.png)

2. 如果运行 launch.bat 后点击 Click to start 仍然没有画面，需要点击运行 /Windows/launch.bat 后出来的窗口，Ctrl+C 一下，看到很多命令在输出就可以了（不是 Ctrl+C 直接关掉窗口了，而是窗口显示仍然在运行） -->

<!-- ## Cesium For Unreal 地景搭建

- 安装 Cesium 插件到 UE，参考 https://cesium.com/learn/unreal/unreal-quickstart/
- 新建一个空 Level，添加一个 SunSky，SunSky 下的 DirectionalLight 的 Intensity 改小一点，如 0.1

![](../images/2023.2.24/15.png)

![](../images/2023.2.24/16.png)

- 调整一下 SunSky 的 Time Zone 到 4.0 左右

![](../images/2023.2.24/18.png)

- 将 CesiumGeorefence 的坐标改到台北附近 24.9389 121.184 2250.0

![](../images/2023.2.24/17.png)

- 添加两个 Blank 3D Tiles Tileset

![](../images/2023.2.24/19.png)

- 选中第一个 Cesium3DTileset，将 Source 改为 From Url，Url 输入本地文件 `/Gis_Data/dem/single_dem/layer.json` 的绝对地址，如 `file:///C:/Users/Zydii/Desktop/Gis_Data/dem/single_dem/layer.json`，本地文件前面加上 `file:///`，所有 `\` 需要改为 `/`，可以看到加载了高程地形

![](../images/2023.2.24/20.png)

- 如果要加载贴图数据，仍然选中第一个 Cesium3DTileset，Add 一个 CesiumTileMapServiceRasterOverlay，在 Url 中填入本地文件 `/Gis_Data/fig/tilemapresource.xml` 的绝对地址，如 `file:///C:/Users/Zydii/Desktop/Gis_Data/fig/tilemapresource.xml`，可以看到加载了贴图数据

![](../images/2023.2.24/21.png)

- 建筑数据同理，选中第二个 Cesium3DTileset，将 Source 改为 From Url，Url 输入 `/Gis_Data/shp/height_50/tileset.json` 的本地绝对地址，如 `file:///C:/Users/Zydii/Desktop/Gis_Data/shp/height_50/tileset.json`，可以看到加载了建筑数据

![](../images/2023.2.24/22.png) -->

# airsim_ros_pkgs

## 安装 WSL2

- 打开 Microsoft Store 搜索 Ubuntu20，安装 Ubuntu 20.04.5 LTS，安装好后点击按钮打开，第一次安装打开后会要求设置用户名和密码，需要记住用户名和密码

![](../images/2023.2.24/23.png)

- 如果不能顺利打开 Ubuntu 可能和 Windows 的一些设置有关，需要根据相关报错百度一下去改一下相关的设置，比如我的电脑在配置过程中参考了 https://blog.csdn.net/q20010619/article/details/120660346: 开启适用于Linux的Windows子系统、Hyper-V、虚拟机平台，参考 https://blog.csdn.net/u014727709/article/details/126538711: 在 BIOS 中开启 CPU 的虚拟化支持

## 安装相关依赖

基本上照着文档操作即可，这里简单列了一下步骤，具体命令使用文档中的命令：https://microsoft.github.io/AirSim/airsim_ros_pkgs/#how-to-run-airsim-on-windows-and-ros-wrapper-on-wsl

### 参考 Setup 部分：

- 安装 gcc，如果安装过程中说 `not found` 可以先 `sudo apt-get update` 再 install
- 参考 Ubuntu 20.04 下面的内容，安装 `ROS noetic` 和 `tf2 sensor and mavros packages` 
- 安装 `catkin_tools`

### 参考 Build 部分：

- Build AirSim：直接按照文档命令操作即可，可能在 cmake 的过程中会报 `find_package` 之类的错误，缺什么包就 `apt-get install` 一下
- 设置 .bashrc 这里需要把命令中的 `melodic` 换成 `noetic`，如果之前已经按照 https://wiki.ros.org/noetic/Installation/Ubuntu 下 1.5 Environment setup 中的命令 `echo "source /opt/ros/noetic/setup.bash" >> ~/.bashrc` 操作过之后可以不再操作这条命令
- Build ROS package：直接按照文档命令操作即可

### 参考 How to run Airsim on Windows and ROS wrapper on WSL 部分：

- 在 Windows 下的 terminal 使用 `wsl -l -v` 确认一下 WSL 为 1 还是 2，我这边默认是 WSL2
- 然后参考文档的部分 WSL1 执行 `export WSL_HOST_IP=127.0.0.1` 或者 WSL2 执行 `export WSL_HOST_IP=$(cat /etc/resolv.conf | grep nameserver | awk '{print $2}')`
- 然后再照着下面的命令输入即可: `source devel/setup.bash` 和 `roslaunch airsim_ros_pkgs airsim_node.launch output:=screen host:=$WSL_HOST_IP`，第三句命令 `roslaunch airsim_ros_pkgs rviz.launch` 好像是涉及可视化的东西，因为 WSL 默认没有 UI，所以这句命令我没有使用
- 运行之后这边命令行会输出 `Waiting for connection - XXXXXXXX` 的 LOG，然后跑一下 Windows 下的 exe 等一会之后就会显示 `Connected!` 了
